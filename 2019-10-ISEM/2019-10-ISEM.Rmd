---
title: "Presentation of the new High-Performance-Cluster"
subtitle: "<html><div style='float:left'></div><hr color='#EB811B' size=1px width=796px></html>"
author: "Patrick Schratz"
date: "ISEM 2019, October 4th 2019, Salzburg, Austria"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      beforeInit: "macros.js"
      ratio: "16:9"
      highlightStyle: solarized-light
      highlightLines: true
      countIncrementalSlides: false
    seal: false
    #chakra: "libs/remark-latest.min.js"
    css: 
       - xaringan-themer.css
       - assets/css/custom.css
---

```{r xaringan-themer, include = FALSE}
options(htmltools.dir.version = FALSE)
library(icon)
library(xaringanthemer)
solarized_light(
  header_font_google = google_font("Josefin Sans"),
  text_font_google   = google_font("Montserrat", "500", "400i"),
  code_font_google   = google_font("Droid Mono"),
  title_slide_background_color = "#002733",
  link_color = "#eb1455",
  text_bold_color = "#00589a",
  text_font_size = "25px",
  header_color = "#002733",
  padding = "1em 2em 1em 2em"
  
)
```

class: title-slide  

# Supporting Ecological Decision Making Using Feature-Selection and Variable Importance

<html><div style='float:left'></div><hr color='#EB811B' size=1px width=796px></html>

### Patrick Schratz

<p style="margin-left:15px;">

<br>

ISEM 2019, October 4th 2019, Salzburg, Austria

<br><br>

`r fa_university()` <sup>1</sup> Department of Geography, GIScience group, University of Jena  <a href="https://www.geographie.uni-jena.de/Geoinformatik.html">`r fa_external_link_alt()`</a>

<br><br>

`r fa_home()` <a href="https://pjs-web.de">https://pjs-web.de</a> &emsp; 

`r fa_twitter()` <a href="https://twitter.com/pjs_228">@pjs_228</a> &emsp; 

`r fa_github()` <a href="https://github.com/pat-s">@pat-s</a> &emsp; 

`r fa_stack_exchange()` <a href="https://stackoverflow.com/users/4185785/pat-s">@pjs_228</a> &emsp;  <br>

`r fa_envelope()` <a href="patrick.schratz@uni-jena.de">patrick.schratz@uni-jena.de</a>&emsp;

`r fa_linkedin()` <a href="https://www.linkedin.com/in/patrick-schratz/">Patrick Schratz</a>&emsp;

</p>

---

# About me

.pull-left[

```{r, echo = FALSE}
knitr::include_graphics("https://pjs-web.de/authors/admin/avatar_hud979e34f5123fec6163cd5fb1cb16697_143342_250x250_fill_q75_box_center.jpg")
```

- M.Sc. Geoinformatics
- Researcher at University of **Jena**
- PhD Candidate

]

.pull-right[
- R developer at University of **Munich**
- Machine-learning in R ([mlr3](https://github.com/mlr-org/mlr3), [mlr](https://github.com/mlr-org/mlr))

```{r, echo = FALSE}
knitr::include_graphics("https://raw.githubusercontent.com/mlr-org/mlr/master/man/figures/logo_navbar.png")
```

### personal focus

- open-source enthusiast
- reproducible research
- high-performance computing
- AUR package maintainer

]

---

# Study Objectives

- Relate **defoliation** at trees to remote-sensing information 
  - raw band information
  - vegetation indices
  - normalized ration indices
  
- Evaluate various (machine/statistical)-learning methods on **predictive performance**

- Compare **dimension-reduction** methods (simple filters, ensemble filters, PCA)

- Analyze the effect of **combined feature sets**

---

# Defoliation

```{r, echo = FALSE}
knitr::include_graphics("https://raw.githubusercontent.com/pat-s/2019-feature-selection/master/code/98-paper/ieee/jpg/defol-grid-pres-1500px.jpg")
```

.large[
&emsp;&emsp; 10 % &emsp;&emsp;&emsp;&emsp;&emsp; 20 %  &emsp;&emsp;&emsp;&emsp;&ensp; 40%  &emsp;&emsp;&emsp;&emsp; 60-70%
]

---

# Hardware

.font150[
**CPU:** AMD Threadripper 2950X, 16-core, 3.5 GHz - 4.4 GHz

**RAM:** 126 GB DDR4

**Disk:** 1 TB M2 SSD

**Nodes:** 4 (3 computes) - soon 7 computes.
]

---

# Software

.font150[

- **OS:** CentOS 7

- **Library Management:** Spack

- **Load Monitoring:** Ganglia

- **Scheduler:** Slurm

- **Cluster Management:** Warewulf

- RStudio Server Pro
]

---

# Why a scheduler?

.font150[

- Takes care of the execution queue for multiple users

- Forces you to think about CPU and memory usage **before** sending your job

- Distributes jobs across the cluster `r fa_arrow_right()` parallelization on the node level

- Only store your project on one machine - the scheduler will distribute the processing for you
]

---

class: center, middle

.font200[
## Live intro to the scheduler
]

---

# Vocabular

.font150[

**Job:** Code to run, e.g. a R script or a single line of code

**Task:** Jobs can consist of multiple tasks. All tasks will have the same settings when submitted via `--array`.

**Compute Node:** One machine in the cluster. Only used for processing.

**Frontend Node:** The "master" node to which you log in. 

]

---

# Sending jobs

.font150[

- via R packages `drake` or `clustermq`

- "Scheduler template" required to tell the scheduler what resources (CPU/Mem) you need
]

---

# Sending jobs

.font180[

`slurm_clustermq.tmpl`

```sh
#!/bin/sh
#SBATCH --job-name={{ job_name }}
#SBATCH --partition=normal
#SBATCH --output={{ log_file | /dev/null }}
#SBATCH --error={{ log_file | /dev/null }}
#SBATCH --cpus-per-task={{ n_cpus }}
#SBATCH --mem={{ memory }}
#SBATCH --array=1-{{ n_jobs }}
```
]

---

# Sending jobs

.font150[

- Arguments of the template are passed via 
  - `drake::make(template = list())` or
  - `clustermq::Q(template = list())`

- Required: 
  - Number of CPUS (`n_cpus`)
  - Memory (`memory`)

]

---

# drake vs. clustermq

.font150[

- `drake` > `clustermq`

- `drake` uses `clustermq` under the hood

- `drake` knows the execution order of all R objects in your project

- `drake` distributes all your analysis in order / parallel to the cluster with ONE R command

]

---

# Libraries

.font150[

Managed via [Spack](spack.io)

- Uses the concept of "environment modules" unter the hood

- All required libraries need to be specifically loaded after login

- Possibility to load libraries at startup (`~/.bashrc`)

]

---

class: center, middle

.font180[
## Live demo: Processing
]

---

# FAQ

.font130[

- Can I login / use the nodes standalone? `r fa_arrow_right()` No.

- Is there a user guide? `r fa_arrow_right()` Yes, at https://jupiter.geogr.uni-jena.de/hpc/

- What if I want to report an issue? `r fa_arrow_right()` https://venus.geogr.uni-jena.de/giscience/hpc-user-guide

- Do I have to use `drake` or `clustermq`? `r fa_arrow_right()` Yes, to use the nodes for processing in R there is no other way.

- `drake` is complicated, I do not understand it. `r fa_arrow_right()` There is a manual (https://ropenscilabs.github.io/drake-manual/#) that will help you understand `r fa_kiwi_bird()`

`r fa_linux()`
]